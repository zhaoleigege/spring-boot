
<!DOCTYPE html>
<html>
  <!-- OriginalSrc: http://brokenrhythm.blog/gradle-gatling-springboot-automation -->
  <head>
    <meta http-equiv="Content-Type" content="text/html"; charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>How to use Gradle and Gatling to automate the load tests of a Spring Boot web service - Broken Rhythm</title>
    
<link href="assets/1547186147-60af10a3248a328e346ca8d64ed8e65a.css" rel="stylesheet">

<link rel="stylesheet" id="social_magazine_bootstrap_css-css" href="assets/1547186147-c019a2918af14cfb114c4ac3426cfc7a.css" type="text/css" media="all">

<link rel="stylesheet" id="social_magazine_font_awesome_css-css" href="assets/1547186147-298be4c32f7a5f02fa38b4aefaff0647.css" type="text/css" media="all">

<link rel="stylesheet" id="social_magazine_style-css" href="assets/1547186147-053d1807715d30632c8965f0bcdc26e3.css" type="text/css" media="all">

<link rel="stylesheet" type="text/css" href="assets/1547186147-93ad947b07a7d9cbbc929a789f71cdad.css">

<link rel="stylesheet" type="text/css" href="assets/1547186147-23b53a9c5f24f97f982677e535465ab3.css">
<style>

</style>
<style>
@media print {#ghostery-purple-box {display:none !important}}
</style>
<style>

img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}

</style>
<style>

           #site-title { color:#000000; }           .post-date { background-color:#476cad; }           a { color:#476cad; }           .blog h2 a:hover { color:#476cad; }           ul.dropdown-menu li a:hover { background:#476cad; }           .btn-primary { background-color:#476cad; }           .btn-primary:hover { background-color:#476cad; }           .btn-default:hover { border-color:#476cad; }           input#submit { background-color:#476cad; }           input#submit:hover { background-color:#476cad; }           
      
</style>
<style>
.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}
</style>
<style>

</style>
<style>
object,embed{                -webkit-animation-duration:.001s;-webkit-animation-name:playerInserted;                -ms-animation-duration:.001s;-ms-animation-name:playerInserted;                -o-animation-duration:.001s;-o-animation-name:playerInserted;                animation-duration:.001s;animation-name:playerInserted;}                @-webkit-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-ms-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @-o-keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}                @keyframes playerInserted{from{opacity:0.99;}to{opacity:1;}}
</style>

    <style class="mx-wc-style">
      .mx-wc-main img {max-width: 100%;}
      .mx-wc-main{
        box-sizing: content-box;
        background-color: rgb(238, 238, 238) !important;
        margin: 0 auto;
        max-width: 700px;
        padding: 15px 15px 80px 15px;
      }

      .mx-wc-main > .clipping-information{
        text-align: left;
        margin-top: 20px;
        background-color: #eeeeee !important;
        padding: 15px;
        border-radius: 4px;
        color: #333;
        font-size: 14px !important;
        line-height: 22px !important;
      }
      .mx-wc-main > .clipping-information a {
        color: blue !important;
        text-decoration: underline !important;
      }
      .mx-wc-main > .clipping-information label {
        display: inline;
        text-transform: none;
      }
      .mx-wc-main > .clipping-information label > code {
        padding: 2px 8px;
        background-color: rgba(200, 200, 200, 0.7)!important;
        font-size: 14px;
      }

    </style>
  </head>
  <body style="background-color: #464646 !important; min-height: 100%; height: auto;" id="" class="post-template-default single single-post postid-300 single-format-standard">
    <div class="mx-wc-main">
      <DIV class="wrap" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><DIV class="container" style="display: block; float: none; position: relative; top: 0; left: 0; border: 0px; width: 100%; min-width:100%; max-width: 100%; min-height: auto; max-height: 100%; height: auto; padding: 0px; margin: 0px;"><div class="col-md-8 blog mx-wc-selected-elem" style="float: none; position: relative; top: 0px; left: 0px; margin: 0px; flex: unset; width: 100%; max-width: 100%; box-sizing: border-box;">
				
			
<h1 id="post-300" class="post-300 post type-post status-publish format-standard has-post-thumbnail hentry category-technology" title="How to use Gradle and Gatling to automate the load tests of a Spring Boot web service">How to use Gradle and Gatling to automate the load tests of a Spring Boot web service</h1>
	
<div class="blog-block single-page">	
	<img width="620" height="280" src="assets/1547186147-1879ef3c5852b1d2a1e90ae07c98c824.png" class="attachment-post-thumbnail size-post-thumbnail wp-post-image" alt="Spring-Gatling-Gradle" sizes="(max-width: 620px) 100vw, 620px">		 
		 <div class="shariff" data-title="How to use Gradle and Gatling to automate the load tests of a Spring Boot web service" data-info-url="http://ct.de/-2467514" data-backend-url="http://brokenrhythm.blog/wp-content/plugins/shariff-sharing/backend/index.php" data-temp="/tmp" data-ttl="60" data-service="gftlxr" data-services="[&quot;googleplus&quot;,&quot;facebook&quot;,&quot;twitter&quot;,&quot;linkedin&quot;,&quot;xing&quot;,&quot;reddit&quot;,&quot;whatsapp&quot;,&quot;mail&quot;,&quot;info&quot;]" data-image="http://brokenrhythm.blog//wp-content/uploads/2017/09/Browser-localhost-greeting.pnghttp://brokenrhythm.blog/wp-content/uploads/2017/09/Browser-localhost-greeting.png 621w, http://brokenrhythm.blog/wp-content/uploads/2017/09/Browser-localhost-greeting-300x142.png 300w" data-url="http://brokenrhythm.blog/gradle-gatling-springboot-automation" data-lang="en" data-theme="round" data-orientation="horizontal"><ul class="theme-round orientation-horizontal"><li class="shariff-button googleplus"><a href="https://plus.google.com/share?url=http%3A%2F%2Fbrokenrhythm.blog%2Fgradle-gatling-springboot-automation" rel="popup" title="Share on Google+"><span class="fa fa-google-plus"></span><span class="share_text">+1</span></a></li><li class="shariff-button facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fbrokenrhythm.blog%2Fgradle-gatling-springboot-automation" rel="popup" title="Share on Facebook"><span class="fa fa-facebook"></span><span class="share_text">share</span></a></li><li class="shariff-button twitter"><a href="https://twitter.com/intent/tweet?text=How%20to%20use%20Gradle%20and%20Gatling%20to%20automate%20the%20load%20tests%20of%20a%20Spring%20Boot%20web%20service&amp;url=http%3A%2F%2Fbrokenrhythm.blog%2Fgradle-gatling-springboot-automation" rel="popup" title="Share on Twitter"><span class="fa fa-twitter"></span><span class="share_text">tweet</span></a></li><li class="shariff-button linkedin"><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Fbrokenrhythm.blog%2Fgradle-gatling-springboot-automation&amp;title=How%20to%20use%20Gradle%20and%20Gatling%20to%20automate%20the%20load%20tests%20of%20a%20Spring%20Boot%20web%20service&amp;summary=&amp;source=" rel="popup" title="Share on LinkedIn"><span class="fa fa-linkedin"></span><span class="share_text">share</span></a></li><li class="shariff-button xing"><a href="http://www.xing.com/social_plugins/share?url=http%3A%2F%2Fbrokenrhythm.blog%2Fgradle-gatling-springboot-automation" rel="popup" title="Share on XING"><span class="fa fa-xing"></span><span class="share_text">share</span></a></li><li class="shariff-button reddit"><a href="http://www.reddit.com/submit?url=http%3A%2F%2Fbrokenrhythm.blog%2Fgradle-gatling-springboot-automation" rel="popup" title="Share on Reddit"><span class="fa fa-reddit"></span><span class="share_text">share</span></a></li><li class="shariff-button mail"><a href="mailto:?body=http%3A%2F%2Fbrokenrhythm.blog%2Fgradle-gatling-springboot-automation&amp;subject=How%20to%20use%20Gradle%20and%20Gatling%20to%20automate%20the%20load%20tests%20of%20a%20Spring%20Boot%20web%20service" target="_blank" title="Send by email"><span class="fa fa-envelope"></span><span class="share_text">mail</span></a></li><li class="shariff-button info"><a href="http://ct.de/-2467514" target="_blank" title="more information"><span class="fa fa-info"></span><span class="share_text">Info</span></a></li></ul></div><p>This is a comprehensive tutorial that explains how to automate the load tests of a <a href="https://spring.io/" target="_blank" rel="noopener">Spring Boot</a>&nbsp;based RESTful Web Service using <a href="http://gatling.io/" target="_blank" rel="noopener">Gatling</a>&nbsp;together with <a href="https://gradle.org/" target="_blank" rel="noopener">Gradle</a>.</p>
<p>You will learn how to combine all the above tools and automate the load testing by defining tasks which can become  part of a CI/CD build pipeline.</p>
<p>If you are not familiar with these tools, don’t worry.&nbsp;This tutorial will explain in details all the steps needed to start with all tools from scratch.</p>
<p>Here is an outline of the various steps you will follow in the tutorial:</p>
<ol>
<li><a href="#Gradle">Create the Gradle Project</a></li>
<li><a href="#Spring">Create the Spring Boot RESTful Web Service</a></li>
<li><a href="#Gatling">Create the Gatling simulation scenario</a></li>
<li><a href="#TestLoad">Setup Gradle to automate the Gatling load tests</a></li>
</ol>
<p>For developers that are already familiar with all three tools, perhaps the most interesting part in this tutorial is the part that explains how to <a href="#TestLoad">Setup Gradle to automate the Gatling load tests</a>.&nbsp;If you have a Spring Boot web service, Gradle build tasks and Gatling simulation scenarios for the load tests already setup, then you could skip the first three parts and jump directly to the <a href="#TestLoad">fourth step</a>.</p>
<p>What this tutorial will not do, is to explain in detail what is happening under the hood for each of the tools. If you are interested in understanding each tool in depth, there are other tutorials to help you. For example for <a href="http://gatling.io/" target="_blank" rel="noopener">Gatling</a>:</p>
<p style="padding-left: 30px;">• <a href="http://gatling.io/docs/current/quickstart/">Gatling quickstart</a><br>
• <a href="http://gatling.io/docs/current/advanced_tutorial/#advanced-tutorial">Gatling Advanced Tutorial</a></p>
<p>for <a href="https://gradle.org/" target="_blank" rel="noopener">Gradle</a>:</p>
<p style="padding-left: 30px;">• <a href="https://guides.gradle.org/creating-new-gradle-builds/">Creating New Gradle Builds</a><br>
• <a href="https://guides.gradle.org/building-java-applications/">Building Java Applications</a><br>
•&nbsp;<a href="https://docs.gradle.org/4.0/userguide/tutorial_java_projects.html">Java Quickstart</a></p>
<p>and for Spring Boot:</p>
<p style="padding-left: 30px;">• <a href="https://spring.io/guides/gs/rest-service/" target="_blank" rel="noopener">Building a RESTful Web Service Tutorial</a><br>
• <a style="background-color: #ffffff;" href="https://spring.io/guides/gs/spring-boot/">Building an Application with Spring Boot</a></p>
<p>Before you start, you need to make sure you have <a href="https://gradle.org/" target="_blank" rel="noopener">Gradle </a>already installed on your system. You can find the installation manual <a href="https://gradle.org/install/" target="_blank" rel="noopener">here</a>.</p>
<p>You also need to have&nbsp;<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">JDK 1.8</a> or later installed on your system.</p>
<p>You can get the complete source code from the git repository:</p>
<p><code>git clone https://bitbucket.org/apostolosbenisis/tutorial-gatling.git</code></p>
<h2 id="create_a_project"><a id="Gradle"></a>Create the Gradle project</h2>
<p>To begin with, create a new folder named&nbsp;<code>tutorial-gatling</code> and create an empty <code>build.gradle</code> file:</p>
<div><div id="highlighter_891840" class="syntaxhighlighter nogutter  powershell"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="powershell plain">mkdir tutorial-gatling </code></div><div class="line number2 index1 alt1"><code class="powershell plain">cd tutorial-gatling </code></div><div class="line number3 index2 alt2"><code class="powershell plain">type nul&gt;build.gradle </code></div></div></td></tr></tbody></table></div></div>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note:&nbsp;</strong>In this tutorial, shell commands are for the Windows operating system. For Unix-based systems it should be easy to find the&nbsp;analogous commands.</span></p>
<p>In the next steps you will gradually fill the&nbsp;<code>build.gradle</code> file with the appropriate code.</p>
<h2><a id="Spring"></a>Create the Spring Boot RESTful Web Service</h2>
<p>For building the Spring Boot web service, you will follow a similar path as the one presented in the&nbsp;<a href="https://spring.io/guides/gs/rest-service/" target="_blank" rel="noopener">Building a RESTful Web Service Tutorial</a>.</p>
<p>You will build a simple RESTful web service that will accept a HTTP GET request and will respond with a JSON string representing the typical hello world greeting.</p>
<h3>Create the java directory structure</h3>
<p>Let’s start by creating the typical java directory structure bellow the&nbsp;<code>tutorial-gatling</code>&nbsp;directory:</p>
<div><div id="highlighter_623117" class="syntaxhighlighter nogutter  powershell"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="powershell plain">cd tutorial-gatling</code></div><div class="line number2 index1 alt1"><code class="powershell plain">mkdir src\main\java\webservice</code></div></div></td></tr></tbody></table></div></div>
<p>The directory structure bellow <code>tutorial-gatling</code> now looks like this:</p>
<div><div id="highlighter_242234" class="syntaxhighlighter nogutter  powershell"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="powershell plain">tutorial-gatling</code></div><div class="line number2 index1 alt1"><code class="powershell plain">└── src</code></div><div class="line number3 index2 alt2"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">└── main</code></div><div class="line number4 index3 alt1"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">└── java</code></div><div class="line number5 index4 alt2"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">└── webservice</code></div></div></td></tr></tbody></table></div></div>
<p>The&nbsp;<code>src\main\java\webservice</code>directory is used for the java code of the web service.</p>
<h3>Setup the Gradle for building</h3>
<p>In a previous <a href="#Gradle">step</a> you created the <code>build.gradle</code> file. Now you will add the code to build the web service. Using your favorite editor, open the&nbsp;<code>build.gradle</code>&nbsp;file and add the following code:</p>
<div><div id="highlighter_422702" class="syntaxhighlighter nogutter  groovy"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="groovy plain">buildscript {</code></div><div class="line number2 index1 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">repositories {</code></div><div class="line number3 index2 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">mavenCentral()</code></div><div class="line number4 index3 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number5 index4 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">dependencies {</code></div><div class="line number6 index5 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">classpath </code><code class="groovy string">'org.springframework.boot:spring-boot-gradle-plugin:1.5.6.RELEASE'</code></div><div class="line number7 index6 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number8 index7 alt1"><code class="groovy plain">}</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="groovy plain">apply plugin: </code><code class="groovy string">'java'</code></div><div class="line number11 index10 alt2"><code class="groovy plain">apply plugin: </code><code class="groovy string">'org.springframework.boot'</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="groovy plain">jar {</code></div><div class="line number14 index13 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">baseName = </code><code class="groovy string">'webservice'</code></div><div class="line number15 index14 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">version = </code><code class="groovy string">'0.1.0'</code></div><div class="line number16 index15 alt1"><code class="groovy plain">}</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="groovy plain">repositories {</code></div><div class="line number19 index18 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">mavenCentral()</code></div><div class="line number20 index19 alt1"><code class="groovy plain">}</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="groovy plain">sourceCompatibility = </code><code class="groovy value">1.8</code></div><div class="line number23 index22 alt2"><code class="groovy plain">targetCompatibility = </code><code class="groovy value">1.8</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="groovy plain">dependencies {</code></div><div class="line number26 index25 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">compile(</code><code class="groovy string">'org.springframework.boot:spring-boot-starter-web'</code><code class="groovy plain">)</code></div><div class="line number27 index26 alt2"><code class="groovy plain">}</code></div></div></td></tr></tbody></table></div></div>
<h3>Create the Spring Boot application</h3>
<p>Using your favorite editor, create the file&nbsp;<code>Application.java</code>in the&nbsp;<code>webservice</code> directory (<code>src\main\java\webservice\Application.java</code>) and add the following code:</p>
<div><div id="highlighter_281796" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">webservice;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">org.springframework.boot.SpringApplication;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">org.springframework.boot.autoconfigure.SpringBootApplication;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java color1">@SpringBootApplication</code></div><div class="line number7 index6 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">Application {</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">void</code> <code class="java plain">main(String[] args) {</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">SpringApplication.run(Application.</code><code class="java keyword">class</code><code class="java plain">, args);</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number12 index11 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>You can read how to bootstrap and launch a Spring application <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/SpringApplication.html">here</a>.</p>
<p>You can read more about the <code>@SpringBootApplication</code>&nbsp;annotation&nbsp;<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-using-springbootapplication-annotation.html" target="_blank" rel="noopener">here</a>.</p>
<h3>Create the resource representation class</h3>
<p>The web service you are building will handle GET requests at the endpoint <code>/greeting</code><br>
and will respond with a <code>200 OK</code> status and a JSON in the body, that represents a greeting. The JSON will look like this:<br>
<code>{"message": "Hello, World"}</code></p>
<p>You will use a POJO to model the greeting.</p>
<p>First, create a&nbsp;<code>model</code> directory bellow the&nbsp;<code>webservice</code> directory.</p>
<p>Then, using your favorite editor, create the file <code>Greeting.java</code>&nbsp;in the new directory (<code>src\main\java\webservice\model\Greeting.java</code>) and add the following code:</p>
<div><div id="highlighter_18619" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">webservice.model;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">Greeting {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java keyword">final</code> <code class="java plain">String message;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">Greeting(String message) {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">this</code><code class="java plain">.message = message;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">String getMessage() {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">message;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number13 index12 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>In a the next step you will see how this object is automatically marshaled to JSON and added to the body of the HTTP GET response, seamlessly by the spring framework.</p>
<h3>Create the controller</h3>
<p>First, create a <code>web</code>&nbsp;directory bellow the&nbsp;<code>webservice</code> directory.</p>
<p>Then, using your favorite editor, create the file&nbsp;<code>GreetingController.java</code>in the new directory (<code>src\main\java\webservice\web\GreetingController.java</code>) and add the following code:</p>
<div><div id="highlighter_473382" class="syntaxhighlighter nogutter  java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">package</code> <code class="java plain">webservice.web;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">import</code> <code class="java plain">webservice.model.Greeting;</code></div><div class="line number4 index3 alt1"><code class="java keyword">import</code> <code class="java plain">org.springframework.web.bind.annotation.RequestMapping;</code></div><div class="line number5 index4 alt2"><code class="java keyword">import</code> <code class="java plain">org.springframework.web.bind.annotation.RestController;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="java color1">@RestController</code></div><div class="line number8 index7 alt1"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">GreetingController {</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@RequestMapping</code><code class="java plain">(</code><code class="java string">"/greeting"</code><code class="java plain">)</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">Greeting greeting() {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">new</code> <code class="java plain">Greeting(</code><code class="java string">"Hello, World"</code><code class="java plain">);</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number13 index12 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>You can read more about the <code><a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/RestController.html">@RestController</a></code> annotation&nbsp;<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-using-springbootapplication-annotation.html" target="_blank" rel="noopener">here</a>&nbsp;and <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/getting-started-first-application.html#getting-started-first-application-annotations">here</a>.</p>
<h3>Build and execute the application</h3>
<p>At this point the web service is completed and you can now build it and launch it. You have set up Gradle to use the Spring Boot Gradle plugin. This plugin offers many convenient methods for building the executing the Spring Boot web service.</p>
<p>Launch the web service by the executing the command&nbsp;<code>gradlew bootRun</code>. Gradle will now download all dependencies and then start the Spring Boot web service. Wait some time until the web services is up and running.</p>
<div><div id="highlighter_942053" class="syntaxhighlighter nogutter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">:compileJava</code></div><div class="line number2 index1 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-parent/1.5.6.RELEASE/spring-boot-starter-parent-1.5.6.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-parent/1.5.6.RELEASE/spring-boot-starter-parent-1.5.6.RELEASE.pom</a></code></div><div class="line number3 index2 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-web/1.5.6.RELEASE/spring-boot-starter-web-1.5.6.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-web/1.5.6.RELEASE/spring-boot-starter-web-1.5.6.RELEASE.pom</a></code></div><div class="line number4 index3 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starters/1.5.6.RELEASE/spring-boot-starters-1.5.6.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starters/1.5.6.RELEASE/spring-boot-starters-1.5.6.RELEASE.pom</a></code></div><div class="line number5 index4 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter/1.5.6.RELEASE/spring-boot-starter-1.5.6.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter/1.5.6.RELEASE/spring-boot-starter-1.5.6.RELEASE.pom</a></code></div><div class="line number6 index5 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-tomcat/1.5.6.RELEASE/spring-boot-starter-tomcat-1.5.6.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-tomcat/1.5.6.RELEASE/spring-boot-starter-tomcat-1.5.6.RELEASE.pom</a></code></div><div class="line number7 index6 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/hibernate/hibernate-validator/5.3.5.Final/hibernate-validator-5.3.5.Final.pom">https://repo1.maven.org/maven2/org/hibernate/hibernate-validator/5.3.5.Final/hibernate-validator-5.3.5.Final.pom</a></code></div><div class="line number8 index7 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/hibernate/hibernate-validator-parent/5.3.5.Final/hibernate-validator-parent-5.3.5.Final.pom">https://repo1.maven.org/maven2/org/hibernate/hibernate-validator-parent/5.3.5.Final/hibernate-validator-parent-5.3.5.Final.pom</a></code></div><div class="line number9 index8 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.8.9/jackson-databind-2.8.9.pom">https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.8.9/jackson-databind-2.8.9.pom</a></code></div><div class="line number10 index9 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-web/4.3.10.RELEASE/spring-web-4.3.10.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/spring-web/4.3.10.RELEASE/spring-web-4.3.10.RELEASE.pom</a></code></div><div class="line number11 index10 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-webmvc/4.3.10.RELEASE/spring-webmvc-4.3.10.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/spring-webmvc/4.3.10.RELEASE/spring-webmvc-4.3.10.RELEASE.pom</a></code></div><div class="line number12 index11 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot/1.5.6.RELEASE/spring-boot-1.5.6.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot/1.5.6.RELEASE/spring-boot-1.5.6.RELEASE.pom</a></code></div><div class="line number13 index12 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-autoconfigure/1.5.6.RELEASE/spring-boot-autoconfigure-1.5.6.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-autoconfigure/1.5.6.RELEASE/spring-boot-autoconfigure-1.5.6.RELEASE.pom</a></code></div><div class="line number14 index13 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-logging/1.5.6.RELEASE/spring-boot-starter-logging-1.5.6.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-logging/1.5.6.RELEASE/spring-boot-starter-logging-1.5.6.RELEASE.pom</a></code></div><div class="line number15 index14 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-core/8.5.16/tomcat-embed-core-8.5.16.pom">https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-core/8.5.16/tomcat-embed-core-8.5.16.pom</a></code></div><div class="line number16 index15 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-el/8.5.16/tomcat-embed-el-8.5.16.pom">https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-el/8.5.16/tomcat-embed-el-8.5.16.pom</a></code></div><div class="line number17 index16 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-websocket/8.5.16/tomcat-embed-websocket-8.5.16.pom">https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-websocket/8.5.16/tomcat-embed-websocket-8.5.16.pom</a></code></div><div class="line number18 index17 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/jboss/logging/jboss-logging/3.3.1.Final/jboss-logging-3.3.1.Final.pom">https://repo1.maven.org/maven2/org/jboss/logging/jboss-logging/3.3.1.Final/jboss-logging-3.3.1.Final.pom</a></code></div><div class="line number19 index18 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-core/2.8.9/jackson-core-2.8.9.pom">https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-core/2.8.9/jackson-core-2.8.9.pom</a></code></div><div class="line number20 index19 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-aop/4.3.10.RELEASE/spring-aop-4.3.10.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/spring-aop/4.3.10.RELEASE/spring-aop-4.3.10.RELEASE.pom</a></code></div><div class="line number21 index20 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-beans/4.3.10.RELEASE/spring-beans-4.3.10.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/spring-beans/4.3.10.RELEASE/spring-beans-4.3.10.RELEASE.pom</a></code></div><div class="line number22 index21 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-context/4.3.10.RELEASE/spring-context-4.3.10.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/spring-context/4.3.10.RELEASE/spring-context-4.3.10.RELEASE.pom</a></code></div><div class="line number23 index22 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-expression/4.3.10.RELEASE/spring-expression-4.3.10.RELEASE.pom">https://repo1.maven.org/maven2/org/springframework/spring-expression/4.3.10.RELEASE/spring-expression-4.3.10.RELEASE.pom</a></code></div><div class="line number24 index23 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/slf4j/jcl-over-slf4j/1.7.25/jcl-over-slf4j-1.7.25.pom">https://repo1.maven.org/maven2/org/slf4j/jcl-over-slf4j/1.7.25/jcl-over-slf4j-1.7.25.pom</a></code></div><div class="line number25 index24 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/slf4j/jul-to-slf4j/1.7.25/jul-to-slf4j-1.7.25.pom">https://repo1.maven.org/maven2/org/slf4j/jul-to-slf4j/1.7.25/jul-to-slf4j-1.7.25.pom</a></code></div><div class="line number26 index25 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/slf4j/log4j-over-slf4j/1.7.25/log4j-over-slf4j-1.7.25.pom">https://repo1.maven.org/maven2/org/slf4j/log4j-over-slf4j/1.7.25/log4j-over-slf4j-1.7.25.pom</a></code></div><div class="line number27 index26 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-web/1.5.6.RELEASE/spring-boot-starter-web-1.5.6.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-web/1.5.6.RELEASE/spring-boot-starter-web-1.5.6.RELEASE.jar</a></code></div><div class="line number28 index27 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter/1.5.6.RELEASE/spring-boot-starter-1.5.6.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter/1.5.6.RELEASE/spring-boot-starter-1.5.6.RELEASE.jar</a></code></div><div class="line number29 index28 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-tomcat/1.5.6.RELEASE/spring-boot-starter-tomcat-1.5.6.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-tomcat/1.5.6.RELEASE/spring-boot-starter-tomcat-1.5.6.RELEASE.jar</a></code></div><div class="line number30 index29 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/hibernate/hibernate-validator/5.3.5.Final/hibernate-validator-5.3.5.Final.jar">https://repo1.maven.org/maven2/org/hibernate/hibernate-validator/5.3.5.Final/hibernate-validator-5.3.5.Final.jar</a></code></div><div class="line number31 index30 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.8.9/jackson-databind-2.8.9.jar">https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.8.9/jackson-databind-2.8.9.jar</a></code></div><div class="line number32 index31 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-web/4.3.10.RELEASE/spring-web-4.3.10.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/spring-web/4.3.10.RELEASE/spring-web-4.3.10.RELEASE.jar</a></code></div><div class="line number33 index32 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-webmvc/4.3.10.RELEASE/spring-webmvc-4.3.10.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/spring-webmvc/4.3.10.RELEASE/spring-webmvc-4.3.10.RELEASE.jar</a></code></div><div class="line number34 index33 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot/1.5.6.RELEASE/spring-boot-1.5.6.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot/1.5.6.RELEASE/spring-boot-1.5.6.RELEASE.jar</a></code></div><div class="line number35 index34 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-autoconfigure/1.5.6.RELEASE/spring-boot-autoconfigure-1.5.6.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-autoconfigure/1.5.6.RELEASE/spring-boot-autoconfigure-1.5.6.RELEASE.jar</a></code></div><div class="line number36 index35 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-logging/1.5.6.RELEASE/spring-boot-starter-logging-1.5.6.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/boot/spring-boot-starter-logging/1.5.6.RELEASE/spring-boot-starter-logging-1.5.6.RELEASE.jar</a></code></div><div class="line number37 index36 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-core/8.5.16/tomcat-embed-core-8.5.16.jar">https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-core/8.5.16/tomcat-embed-core-8.5.16.jar</a></code></div><div class="line number38 index37 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-el/8.5.16/tomcat-embed-el-8.5.16.jar">https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-el/8.5.16/tomcat-embed-el-8.5.16.jar</a></code></div><div class="line number39 index38 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-websocket/8.5.16/tomcat-embed-websocket-8.5.16.jar">https://repo1.maven.org/maven2/org/apache/tomcat/embed/tomcat-embed-websocket/8.5.16/tomcat-embed-websocket-8.5.16.jar</a></code></div><div class="line number40 index39 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/jboss/logging/jboss-logging/3.3.1.Final/jboss-logging-3.3.1.Final.jar">https://repo1.maven.org/maven2/org/jboss/logging/jboss-logging/3.3.1.Final/jboss-logging-3.3.1.Final.jar</a></code></div><div class="line number41 index40 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-core/2.8.9/jackson-core-2.8.9.jar">https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-core/2.8.9/jackson-core-2.8.9.jar</a></code></div><div class="line number42 index41 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-aop/4.3.10.RELEASE/spring-aop-4.3.10.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/spring-aop/4.3.10.RELEASE/spring-aop-4.3.10.RELEASE.jar</a></code></div><div class="line number43 index42 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-beans/4.3.10.RELEASE/spring-beans-4.3.10.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/spring-beans/4.3.10.RELEASE/spring-beans-4.3.10.RELEASE.jar</a></code></div><div class="line number44 index43 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-context/4.3.10.RELEASE/spring-context-4.3.10.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/spring-context/4.3.10.RELEASE/spring-context-4.3.10.RELEASE.jar</a></code></div><div class="line number45 index44 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/springframework/spring-expression/4.3.10.RELEASE/spring-expression-4.3.10.RELEASE.jar">https://repo1.maven.org/maven2/org/springframework/spring-expression/4.3.10.RELEASE/spring-expression-4.3.10.RELEASE.jar</a></code></div><div class="line number46 index45 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/slf4j/jcl-over-slf4j/1.7.25/jcl-over-slf4j-1.7.25.jar">https://repo1.maven.org/maven2/org/slf4j/jcl-over-slf4j/1.7.25/jcl-over-slf4j-1.7.25.jar</a></code></div><div class="line number47 index46 alt2"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/slf4j/jul-to-slf4j/1.7.25/jul-to-slf4j-1.7.25.jar">https://repo1.maven.org/maven2/org/slf4j/jul-to-slf4j/1.7.25/jul-to-slf4j-1.7.25.jar</a></code></div><div class="line number48 index47 alt1"><code class="plain plain">Download <a href="https://repo1.maven.org/maven2/org/slf4j/log4j-over-slf4j/1.7.25/log4j-over-slf4j-1.7.25.jar">https://repo1.maven.org/maven2/org/slf4j/log4j-over-slf4j/1.7.25/log4j-over-slf4j-1.7.25.jar</a></code></div><div class="line number49 index48 alt2"><code class="plain plain">:processResources UP-TO-DATE</code></div><div class="line number50 index49 alt1"><code class="plain plain">:classes</code></div><div class="line number51 index50 alt2"><code class="plain plain">:findMainClass</code></div><div class="line number52 index51 alt1"><code class="plain plain">:bootRun</code></div><div class="line number53 index52 alt2"><code class="plain spaces">&nbsp;&nbsp;</code><code class="plain plain">.&nbsp;&nbsp; ____&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; __ _ _</code></div><div class="line number54 index53 alt1"><code class="plain spaces">&nbsp;</code><code class="plain plain">/\\ / ___'_ __ _ _(_)_ __&nbsp; __ _ \ \ \ \</code></div><div class="line number55 index54 alt2"><code class="plain plain">( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \</code></div><div class="line number56 index55 alt1"><code class="plain spaces">&nbsp;</code><code class="plain plain">\\/&nbsp; ___)| |_)| | | | | || (_| |&nbsp; ) ) ) )</code></div><div class="line number57 index56 alt2"><code class="plain spaces">&nbsp;&nbsp;</code><code class="plain plain">'&nbsp; |____| .__|_| |_|_| |_\__, | / / / /</code></div><div class="line number58 index57 alt1"><code class="plain spaces">&nbsp;</code><code class="plain plain">=========|_|==============|___/=/_/_/_/</code></div><div class="line number59 index58 alt2"><code class="plain spaces">&nbsp;</code><code class="plain plain">:: Spring Boot ::&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (v1.5.6.RELEASE)</code></div><div class="line number60 index59 alt1">&nbsp;</div><div class="line number61 index60 alt2"><code class="plain plain">2017-09-11 19:46:45.095&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] webservice.Application&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Starting Application on UP with PID 9376 (D:\Projects\tutorial-gatling\build\classes\main started by Apostolos Benisis in D:\Projects\tutorial-gatling)</code></div><div class="line number62 index61 alt1"><code class="plain plain">2017-09-11 19:46:45.098&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] webservice.Application&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : No active profile set, falling back to default profiles: default</code></div><div class="line number63 index62 alt2"><code class="plain plain">2017-09-11 19:46:45.142&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@4a7dd4: startup date [Mon Sep 11 19:46:45 CEST 2017]; root of context hierarchy</code></div><div class="line number64 index63 alt1"><code class="plain plain">2017-09-11 19:46:46.330&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)</code></div><div class="line number65 index64 alt2"><code class="plain plain">2017-09-11 19:46:46.340&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] o.apache.catalina.core.StandardService&nbsp;&nbsp; : Starting service [Tomcat]</code></div><div class="line number66 index65 alt1"><code class="plain plain">2017-09-11 19:46:46.341&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] org.apache.catalina.core.StandardEngine&nbsp; : Starting Servlet Engine: Apache Tomcat/8.5.16</code></div><div class="line number67 index66 alt2"><code class="plain plain">2017-09-11 19:46:46.427&nbsp; INFO 9376 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Initializing Spring embedded WebApplicationContext</code></div><div class="line number68 index67 alt1"><code class="plain plain">2017-09-11 19:46:46.427&nbsp; INFO 9376 --- [ost-startStop-1] o.s.web.context.ContextLoader&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Root WebApplicationContext: initialization completed in 1287 ms</code></div><div class="line number69 index68 alt2"><code class="plain plain">2017-09-11 19:46:46.538&nbsp; INFO 9376 --- [ost-startStop-1] o.s.b.w.servlet.ServletRegistrationBean&nbsp; : Mapping servlet: 'dispatcherServlet' to [/]</code></div><div class="line number70 index69 alt1"><code class="plain plain">2017-09-11 19:46:46.541&nbsp; INFO 9376 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean&nbsp;&nbsp; : Mapping filter: 'characterEncodingFilter' to: [/*]</code></div><div class="line number71 index70 alt2"><code class="plain plain">2017-09-11 19:46:46.542&nbsp; INFO 9376 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean&nbsp;&nbsp; : Mapping filter: 'hiddenHttpMethodFilter' to: [/*]</code></div><div class="line number72 index71 alt1"><code class="plain plain">2017-09-11 19:46:46.542&nbsp; INFO 9376 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean&nbsp;&nbsp; : Mapping filter: 'httpPutFormContentFilter' to: [/*]</code></div><div class="line number73 index72 alt2"><code class="plain plain">2017-09-11 19:46:46.542&nbsp; INFO 9376 --- [ost-startStop-1] o.s.b.w.servlet.FilterRegistrationBean&nbsp;&nbsp; : Mapping filter: 'requestContextFilter' to: [/*]</code></div><div class="line number74 index73 alt1"><code class="plain plain">2017-09-11 19:46:46.784&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking for @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@4a7dd4: startup date [Mon Sep 11 19:46:45 CEST 2017]; root of context hierarchy</code></div><div class="line number75 index74 alt2"><code class="plain plain">2017-09-11 19:46:46.839&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/greeting]}" onto public webservice.model.Greeting webservice.web.GreetingController.greeting()</code></div><div class="line number76 index75 alt1"><code class="plain plain">2017-09-11 19:46:46.841&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error]}" onto public org.springframework.http.ResponseEntity&lt;java.util.Map&lt;java.lang.String, java.lang.Object&gt;&gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)</code></div><div class="line number77 index76 alt2"><code class="plain plain">2017-09-11 19:46:46.842&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped "{[/error],produces=}" onto public org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse)</code></div><div class="line number78 index77 alt1"><code class="plain plain">2017-09-11 19:46:46.863&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] o.s.w.s.handler.SimpleUrlHandlerMapping&nbsp; : Mapped URL path [/webjars/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</code></div><div class="line number79 index78 alt2"><code class="plain plain">2017-09-11 19:46:46.863&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] o.s.w.s.handler.SimpleUrlHandlerMapping&nbsp; : Mapped URL path [/**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</code></div><div class="line number80 index79 alt1"><code class="plain plain">2017-09-11 19:46:46.894&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] o.s.w.s.handler.SimpleUrlHandlerMapping&nbsp; : Mapped URL path [/**/favicon.ico] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]</code></div><div class="line number81 index80 alt2"><code class="plain plain">2017-09-11 19:46:47.008&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] o.s.j.e.a.AnnotationMBeanExporter&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Registering beans for JMX exposure on startup</code></div><div class="line number82 index81 alt1"><code class="plain plain">2017-09-11 19:46:47.051&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)</code></div><div class="line number83 index82 alt2"><code class="plain plain">2017-09-11 19:46:47.054&nbsp; INFO 9376 --- [&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; main] webservice.Application&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; : Started Application in 2.217 seconds (JVM running for 2.492)</code></div><div class="line number84 index83 alt1"><code class="plain plain">&gt; Building 83% &gt; :bootRun</code></div></div></td></tr></tbody></table></div></div>
<p>Alternately, you can use the command <code>gradlew build</code> to build and assemble all dependencies and the compiled classes in a single, runnable “über-jar” jar file. The jar file can then be executed with <code>java -jar build/libs/webservice-0.1.0.jar.jar</code></p>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note</strong>: All Gradle commands must executed from the <code>tutorial-gatling</code> directory where the <code>build.gradle</code> file is located.</span></p>
<p>Now, open in a browser the url <code>http://localhost:8080/greeting</code></p>
<p>You should now see in the browser the greeting in JSON format.</p>
<p><img class="alignnone wp-image-442 size-full" src="assets/1547186147-bd19848450c0ecd1f170907890a8e49b.png" alt="JSON greeting" width="621" height="293" sizes="(max-width: 621px) 100vw, 621px"></p>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note: </strong>Instead of opening a browser, you can run <code>curl http://localhost:8080/greeting</code> from the command prompt. The windows operating system does not come with curl, &nbsp;so you have to download it from&nbsp;<a href="https://curl.haxx.se/download.html" target="_blank" rel="noopener">here</a> and install it on your system. If you have <code>Git</code>&nbsp;already installed on your system, just open a <code>Git bash</code>&nbsp;and run the <code>curl</code> command. It is already included with the Git distribution.</span></p>
<h2><a id="Gatling"></a>Create the Gatling simulation scenario</h2>
<p><a href="http://gatling.io/" target="_blank" rel="noopener">Gatling</a>&nbsp;is a load and performance testing tool. You will now learn how to create a <em>scenario </em>and run a <em>simulation </em>to load test the web service you created in the previous steps.</p>
<h3>Installation</h3>
<p>You will add Gatling as a dependency in the Gradle <code>build.gradle</code> file and let Gradle download all required files.</p>
<p>Since you don’t want to distribute Gatling together with the production artifacts, you will add it as a <code>testCompile</code> dependency.</p>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note</strong>: You can find more information on the dependency types of the java plugin <a href="https://docs.gradle.org/current/userguide/java_plugin.html#sec:java_plugin_and_dependency_management" target="_blank" rel="noopener">here</a>.</span></p>
<p>Edit the <code>build.gradle</code> file and add the line&nbsp;<code>testCompile('io.gatling.highcharts:gatling-charts-highcharts:2.3.0')</code> in the dependencies section, towards the end of the file.</p>
<p>The Gatling simulation scenarios are written in <a href="https://www.scala-lang.org/" target="_blank" rel="noopener">Scala </a> code. To compile the Scala code you will add &nbsp;<code>apply plugin: 'scala'</code>&nbsp;next to the other plugin entries.</p>
<p>The file should look like this:</p>
<div><div id="highlighter_127146" class="syntaxhighlighter nogutter  groovy"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="groovy plain">...</code></div><div class="line number2 index1 alt1"><code class="groovy plain">...</code></div><div class="line number3 index2 alt2"><code class="groovy plain">...</code></div><div class="line number4 index3 alt1"><code class="groovy plain">apply plugin: </code><code class="groovy string">'java'</code></div><div class="line number5 index4 alt2"><code class="groovy plain">apply plugin: </code><code class="groovy string">'org.springframework.boot'</code></div><div class="line number6 index5 alt1 highlighted"><code class="groovy plain">apply plugin: </code><code class="groovy string">'scala'</code></div><div class="line number7 index6 alt2"><code class="groovy plain">...</code></div><div class="line number8 index7 alt1"><code class="groovy plain">...</code></div><div class="line number9 index8 alt2"><code class="groovy plain">...</code></div><div class="line number10 index9 alt1"><code class="groovy plain">dependencies {</code></div><div class="line number11 index10 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">compile(</code><code class="groovy string">'org.springframework.boot:spring-boot-starter-web'</code><code class="groovy plain">)</code></div><div class="line number12 index11 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">testCompile(</code><code class="groovy string">'io.gatling.highcharts:gatling-charts-highcharts:2.3.0'</code><code class="groovy plain">)</code></div><div class="line number13 index12 alt2"><code class="groovy plain">}</code></div></div></td></tr></tbody></table></div></div>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note</strong>: Gatling offers a manual installation with a zip bundle. If you want to run Gatling manually from the command prompt, you should additionally follow the zip file based installation described in the <a href="http://gatling.io/docs/current/quickstart/" target="_blank" rel="noopener">quickstart guide</a></span></p>
<h3>Create the Scala directory structure</h3>
<p>First, create the directory structure bellow the&nbsp;<code>tutorial-gatling</code>&nbsp;directory for storing the Gatling simulation scenario. In the command prompt go to&nbsp;the&nbsp;<code>tutorial-gatling</code>&nbsp;directory and then run:</p>
<div><div id="highlighter_835404" class="syntaxhighlighter nogutter  powershell"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="powershell plain">mkdir src\test\scala\webservice\gatling\simulation</code></div><div class="line number2 index1 alt1"><code class="powershell plain">mkdir src\test\resources</code></div></div></td></tr></tbody></table></div></div>
<p>The directory structure bellow <code>tutorial-gatling</code> now looks like this:</p>
<div><div id="highlighter_71669" class="syntaxhighlighter nogutter  powershell"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="powershell plain">tutorial-gatling</code></div><div class="line number2 index1 alt1"><code class="powershell plain">└── src</code></div><div class="line number3 index2 alt2"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">├── main</code></div><div class="line number4 index3 alt1"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">|&nbsp;&nbsp; └── java</code></div><div class="line number5 index4 alt2"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; └── webservice</code></div><div class="line number6 index5 alt1"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">└── test</code></div><div class="line number7 index6 alt2"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">├── scala</code></div><div class="line number8 index7 alt1"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">|&nbsp;&nbsp; └── webservice</code></div><div class="line number9 index8 alt2"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; └── gatling</code></div><div class="line number10 index9 alt1"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; └── simulation</code></div><div class="line number11 index10 alt2"><code class="powershell spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="powershell plain">└── resources&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div></div></td></tr></tbody></table></div></div>
<h3>Create the test scenario</h3>
<p>The web service you created in the previous steps has a single and very simple end point (<code>http://localhost:8080/greeting</code>). In the next step you will &nbsp;create a simple test scenario to test the performance of the web service when it is actually consumed. In details it will do the following:</p>
<ol style="list-style-type: lower-alpha;">
<li>The request will simulate a user using Firefox.</li>
<li>It will run for 20 seconds (<code>testTimeSecs = 20</code>).</li>
<li>During this time a user continuously requests the endpoint <code>http://localhost:8080/greeting</code> and expects a response with the status <code>200 OK</code>.</li>
<li>Between two requests, the user will pause for 1 to 3 seconds. (<code>minWaitMs = 1000 millisecons maxWaitMs = 3000 milliseconds</code>).</li>
<li>The number of users connecting simultaneously are 10 (<code>noOfUsers = 10)</code>.</li>
<li>It will take 5 seconds (<code>rampUpTimeSecs = 5</code>) to ramp up the number of users from 0 to 10.</li>
</ol>
<p>Using your favorite editor, create the file <code>WebServiceCallSimulation.scala</code> in the new directory (<code>src\test\scala\webservice\gatling\simulation\WebServiceCallSimulation.scala</code>) and add the following code:</p>
<div><div id="highlighter_725234" class="syntaxhighlighter nogutter  scala"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="scala keyword">package</code> <code class="scala plain">webservice.gatling.simulation</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="scala keyword">import</code> <code class="scala plain">io.gatling.core.Predef.</code><code class="scala keyword">_</code></div><div class="line number4 index3 alt1"><code class="scala keyword">import</code> <code class="scala plain">io.gatling.http.Predef.</code><code class="scala keyword">_</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="scala keyword">import</code> <code class="scala plain">scala.concurrent.duration.</code><code class="scala keyword">_</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="scala keyword">class</code> <code class="scala plain">WebServiceCallSimulation </code><code class="scala keyword">extends</code> <code class="scala plain">Simulation {</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">rampUpTimeSecs </code><code class="scala keyword">=</code> <code class="scala value">5</code></div><div class="line number11 index10 alt2"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">testTimeSecs </code><code class="scala keyword">=</code> <code class="scala value">20</code></div><div class="line number12 index11 alt1"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">noOfUsers </code><code class="scala keyword">=</code> <code class="scala value">10</code></div><div class="line number13 index12 alt2"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">minWaitMs </code><code class="scala keyword">=</code> <code class="scala value">1000</code> <code class="scala plain">milliseconds</code></div><div class="line number14 index13 alt1"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">maxWaitMs </code><code class="scala keyword">=</code> <code class="scala value">3000</code> <code class="scala plain">milliseconds</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">baseURL </code><code class="scala keyword">=</code> <code class="scala string">"<a href="http://localhost:8080/">http://localhost:8080</a>"</code></div><div class="line number17 index16 alt2"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">baseName </code><code class="scala keyword">=</code> <code class="scala string">"webservice-call-greeting"</code></div><div class="line number18 index17 alt1"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">requestName </code><code class="scala keyword">=</code> <code class="scala plain">baseName + </code><code class="scala string">"-request"</code></div><div class="line number19 index18 alt2"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">scenarioName </code><code class="scala keyword">=</code> <code class="scala plain">baseName + </code><code class="scala string">"-scenario"</code></div><div class="line number20 index19 alt1"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">URI </code><code class="scala keyword">=</code> <code class="scala string">"/greeting"</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">httpConf </code><code class="scala keyword">=</code> <code class="scala plain">http</code></div><div class="line number23 index22 alt2"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">.baseURL(baseURL)</code></div><div class="line number24 index23 alt1"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">.acceptHeader(</code><code class="scala string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</code><code class="scala plain">) </code><code class="scala comments">// 6</code></div><div class="line number25 index24 alt2"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">.doNotTrackHeader(</code><code class="scala string">"1"</code><code class="scala plain">)</code></div><div class="line number26 index25 alt1"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">.acceptLanguageHeader(</code><code class="scala string">"en-US,en;q=0.5"</code><code class="scala plain">)</code></div><div class="line number27 index26 alt2"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">.acceptEncodingHeader(</code><code class="scala string">"gzip, deflate"</code><code class="scala plain">)</code></div><div class="line number28 index27 alt1"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">.userAgentHeader(</code><code class="scala string">"Mozilla/5.0 (Windows NT 5.1; rv:31.0) Gecko/20100101 Firefox/31.0"</code><code class="scala plain">)</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="scala spaces">&nbsp;</code><code class="scala keyword">val</code> <code class="scala plain">scn </code><code class="scala keyword">=</code> <code class="scala plain">scenario(scenarioName)</code></div><div class="line number31 index30 alt2"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">.during(testTimeSecs) {</code></div><div class="line number32 index31 alt1"><code class="scala spaces">&nbsp;&nbsp;&nbsp;</code><code class="scala plain">exec(</code></div><div class="line number33 index32 alt2"><code class="scala spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="scala plain">http(requestName)</code></div><div class="line number34 index33 alt1"><code class="scala spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="scala plain">.get(URI)</code></div><div class="line number35 index34 alt2"><code class="scala spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="scala plain">.check(status.is(</code><code class="scala value">200</code><code class="scala plain">))</code></div><div class="line number36 index35 alt1"><code class="scala spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="scala plain">).pause(minWaitMs, maxWaitMs) </code></div><div class="line number37 index36 alt2"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">}</code></div><div class="line number38 index37 alt1"><code class="scala spaces">&nbsp;</code>&nbsp;</div><div class="line number39 index38 alt2"><code class="scala spaces">&nbsp;</code><code class="scala plain">setUp(</code></div><div class="line number40 index39 alt1"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">scn.inject(rampUsers(noOfUsers) over (rampUpTimeSecs))</code></div><div class="line number41 index40 alt2"><code class="scala spaces">&nbsp;&nbsp;</code><code class="scala plain">).protocols(httpConf)</code></div><div class="line number42 index41 alt1"><code class="scala spaces">&nbsp;</code><code class="scala plain">}</code></div></div></td></tr></tbody></table></div></div>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note:</strong>You can find more information on user agent header string <a href="http://www.useragentstring.com/pages/useragentstring.php">here</a>.</span></p>
<h3>Configure logging for Gatling</h3>
<p>Next you will configure the logging level for Gatling to make it less verbose. Gatling uses <a href="https://logback.qos.ch/index.html">Logback</a>.</p>
<p>Using your favorite editor, create the file <code>logback-gatling.xml</code> in the <code>src\test\resources</code>&nbsp;directory (<code>src\test\resources\logback-gatling.xml</code>) and add the following code:</p>
<div><div id="highlighter_357289" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="xml plain">&lt;?</code><code class="xml keyword">xml</code> <code class="xml color1">version</code><code class="xml plain">=</code><code class="xml string">"1.0"</code> <code class="xml color1">encoding</code><code class="xml plain">=</code><code class="xml string">"UTF-8"</code><code class="xml plain">?&gt;</code></div><div class="line number2 index1 alt1"><code class="xml plain">&lt;</code><code class="xml keyword">configuration</code><code class="xml plain">&gt;</code></div><div class="line number3 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">appender</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"CONSOLE"</code> <code class="xml color1">class</code><code class="xml plain">=</code><code class="xml string">"ch.qos.logback.core.ConsoleAppender"</code><code class="xml plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">encoder</code><code class="xml plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">pattern</code><code class="xml plain">&gt;%d{HH:mm:ss.SSS} [%-5level] %logger{15} - %msg%n%rEx&lt;/</code><code class="xml keyword">pattern</code><code class="xml plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">immediateFlush</code><code class="xml plain">&gt;false&lt;/</code><code class="xml keyword">immediateFlush</code><code class="xml plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">encoder</code><code class="xml plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">appender</code><code class="xml plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Uncomment for logging ALL HTTP request and responses --&gt;</code></div><div class="line number10 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!--&nbsp;&nbsp;&nbsp; &lt;logger name="io.gatling.http.ahc" level="TRACE" /&gt; --&gt;</code></div><div class="line number11 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!--&nbsp;&nbsp;&nbsp; &lt;logger name="io.gatling.http.response" level="TRACE" /&gt; --&gt;</code></div><div class="line number12 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Uncomment for logging ONLY FAILED HTTP request and responses --&gt;</code></div><div class="line number13 index12 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!--&nbsp;&nbsp;&nbsp; &lt;logger name="io.gatling.http.ahc" level="DEBUG" /&gt; --&gt;</code></div><div class="line number14 index13 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!--&nbsp;&nbsp;&nbsp; &lt;logger name="io.gatling.http.response" level="DEBUG" /&gt; --&gt;</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">root</code> <code class="xml color1">level</code><code class="xml plain">=</code><code class="xml string">"ERROR"</code><code class="xml plain">&gt;</code></div><div class="line number17 index16 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">appender-ref</code> <code class="xml color1">ref</code><code class="xml plain">=</code><code class="xml string">"CONSOLE"</code><code class="xml plain">/&gt;</code></div><div class="line number18 index17 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">root</code><code class="xml plain">&gt;</code></div><div class="line number19 index18 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">configuration</code><code class="xml plain">&gt;</code></div></div></td></tr></tbody></table></div></div>
<h3>Setup the Gatling <code>testLoad</code> task in Gradle</h3>
<p>Instead of running Gatling from the command prompt, you will run it from a Gradle task.</p>
<p>In a previous step you learned how you can download the package in a convenient way, by declaring the appropriate dependency in the <code>build.gradle</code> script.</p>
<p>Now you will define a new Gradle task to execute the specific simulation from Gradle. It will be named<code>testLoad</code>and it will be a java based Gradle task.<br>
The task will execute the main Gatling class <code>io.gatling.app.Gatling</code> and pass required parameters such as:</p>
<p style="padding-left: 30px;">• the location where the compiled simulation classes can be found (<code>-Dgatling.core.directory.binaries</code>),<br>
• the Logback configuration file (<code>-Dlogback.configurationFile</code>),<br>
• the simulation class name to be executed (<code>--simulation</code>) and<br>
• the location to store the results of the simulation runs (<code>--results-folder</code>)</p>
<p>Edit the&nbsp;<code>build.gradle</code>&nbsp;file and add at the end of the file the following code:</p>
<div><div id="highlighter_705866" class="syntaxhighlighter nogutter  groovy"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="groovy comments">/**</code></div><div class="line number2 index1 alt1"><code class="groovy spaces">&nbsp;</code><code class="groovy comments">* Gatling load tests</code></div><div class="line number3 index2 alt2"><code class="groovy spaces">&nbsp;</code><code class="groovy comments">*/</code></div><div class="line number4 index3 alt1"><code class="groovy plain">task testLoad(type: JavaExec) {</code></div><div class="line number5 index4 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">description = </code><code class="groovy string">'Test load the Spring Boot web service with Gatling'</code></div><div class="line number6 index5 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">group = </code><code class="groovy string">'Load Test'</code></div><div class="line number7 index6 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">classpath = sourceSets.test.runtimeClasspath</code></div><div class="line number8 index7 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">jvmArgs = [</code></div><div class="line number9 index8 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy comments">// workaround for <a href="https://github.com/gatling/gatling/issues/2689">https://github.com/gatling/gatling/issues/2689</a></code></div><div class="line number10 index9 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">"-Dgatling.core.directory.binaries=${sourceSets.test.output.classesDir.toString()}"</code><code class="groovy plain">,</code></div><div class="line number11 index10 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">"-Dlogback.configurationFile=${logbackGatlingConfig()}"</code></div><div class="line number12 index11 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">]</code></div><div class="line number13 index12 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">main = </code><code class="groovy string">'io.gatling.app.Gatling'</code></div><div class="line number14 index13 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">args = [</code></div><div class="line number15 index14 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">'--simulation'</code><code class="groovy plain">, </code><code class="groovy string">'webservice.gatling.simulation.WebServiceCallSimulation'</code><code class="groovy plain">,</code></div><div class="line number16 index15 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">'--results-folder'</code><code class="groovy plain">, </code><code class="groovy string">"${buildDir}/gatling-results"</code><code class="groovy plain">,</code></div><div class="line number17 index16 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">'--binaries-folder'</code><code class="groovy plain">, sourceSets.test.output.classesDir.toString() </code><code class="groovy comments">// ignored because of above bug&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number18 index17 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">]</code></div><div class="line number19 index18 alt2"><code class="groovy plain">}</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="groovy keyword">def</code> <code class="groovy plain">logbackGatlingConfig() {</code></div><div class="line number22 index21 alt1"><code class="groovy spaces">&nbsp;</code><code class="groovy keyword">return</code> <code class="groovy plain">sourceSets.test.resources.</code><code class="groovy functions">find</code> <code class="groovy plain">{ it.name == </code><code class="groovy string">'logback-gatling.xml'</code><code class="groovy plain">};</code></div><div class="line number23 index22 alt2"><code class="groovy plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>At this point everything is prepared to run the load test.</p>
<h3>Manually run the load test</h3>
<p>You will now manually execute the Gatling simulation. If the Spring Boot web service is not already running, you need to start it before the simulation can run. You will need two command prompts.</p>
<p>In the first command prompt execute&nbsp;<code>gradlew bootRun</code>&nbsp;to launch the&nbsp;Spring Boot web service, if it is not already running.</p>
<p>In the second command prompt execute<code>gradlew testLoad</code>to start the Gatling test. Wait until the Spring Boot web service is up and running before starting the Gatling test, otherwise the test will report failed requests. Gradle will do all required jobs to run the task e.g. download any dependencies, compile and assemble packages and eventually Gatling will start and run the simualtion. You should now see some output in the console with the results of the Gatling test:</p>
<div><div id="highlighter_305789" class="syntaxhighlighter nogutter  plain"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="plain plain">---- webservice-call-greeting-scenario -----------------------------------------</code></div><div class="line number2 index1 alt1"><code class="plain plain">[##########################################################################]100%</code></div><div class="line number3 index2 alt2"><code class="plain spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain plain">waiting: 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; / active: 0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; / done:10</code></div><div class="line number4 index3 alt1"><code class="plain plain">================================================================================</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="plain plain">Simulation webservice.gatling.simulation.WebServiceCallSimulation completed in 25 seconds</code></div><div class="line number7 index6 alt2"><code class="plain plain">Parsing log file(s)...</code></div><div class="line number8 index7 alt1"><code class="plain plain">Parsing log file(s) done</code></div><div class="line number9 index8 alt2"><code class="plain plain">Generating reports...</code></div><div class="line number10 index9 alt1"><code class="plain plain">&gt; Building 87% &gt; :testLoad</code></div><div class="line number11 index10 alt2"><code class="plain plain">================================================================================</code></div><div class="line number12 index11 alt1"><code class="plain plain">---- Global Information --------------------------------------------------------</code></div><div class="line number13 index12 alt2"><code class="plain plain">&gt; request count&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 108 (OK=108&nbsp;&nbsp;&nbsp; KO=0&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number14 index13 alt1"><code class="plain plain">&gt; min response time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 5 (OK=5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number15 index14 alt2"><code class="plain plain">&gt; max response time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 128 (OK=128&nbsp;&nbsp;&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number16 index15 alt1"><code class="plain plain">&gt; mean response time&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9 (OK=9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number17 index16 alt2"><code class="plain plain">&gt; std deviation&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12 (OK=12&nbsp;&nbsp;&nbsp;&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number18 index17 alt1"><code class="plain plain">&gt; response time 50th percentile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7 (OK=7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number19 index18 alt2"><code class="plain plain">&gt; response time 75th percentile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 9 (OK=9&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number20 index19 alt1"><code class="plain plain">&gt; response time 95th percentile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 17 (OK=17&nbsp;&nbsp;&nbsp;&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number21 index20 alt2"><code class="plain plain">&gt; response time 99th percentile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 21 (OK=21&nbsp;&nbsp;&nbsp;&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number22 index21 alt1"><code class="plain plain">&gt; mean requests/sec&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 4.154 (OK=4.154&nbsp; KO=-&nbsp;&nbsp;&nbsp;&nbsp; )</code></div><div class="line number23 index22 alt2"><code class="plain plain">---- Response Time Distribution ------------------------------------------------</code></div><div class="line number24 index23 alt1"><code class="plain plain">&gt; t &lt; 800 ms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 108 (100%)</code></div><div class="line number25 index24 alt2"><code class="plain plain">&gt; 800 ms &lt; t &lt; 1200 ms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 (&nbsp; 0%)</code></div><div class="line number26 index25 alt1"><code class="plain plain">&gt; t &gt; 1200 ms&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 (&nbsp; 0%)</code></div><div class="line number27 index26 alt2"><code class="plain plain">&gt; failed&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 0 (&nbsp; 0%)</code></div><div class="line number28 index27 alt1"><code class="plain plain">================================================================================</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="plain plain">Reports generated in 0s.</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="plain plain">Reports generated in 0s.</code></div><div class="line number33 index32 alt2"><code class="plain plain">Please open the following file: C:\Git Repositories\tutorial-gatling\build\gatling-results\webservicecallsimulation-1505126773724\index.html</code></div></div></td></tr></tbody></table></div></div>
<p>In the <code>tutorial-gatling\build\gatling-results</code> directory you can find the reports of the executed simulation runs. Here is how such a report looks like:</p>
<p><img class="alignnone wp-image-442 size-full" src="assets/1547186147-e06ee972168bfc3934ec6e9a79db198b.png" alt="Gatling report"></p>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note</strong>: If you have downloaded the zip bundle of Gatling as described in the&nbsp;<a href="http://gatling.io/docs/current/quickstart/" target="_blank" rel="noopener">quickstart guide</a>&nbsp;you can manually run the &nbsp;simulation from the command prompt: <code>"%GATLING_HOME%\bin\gatling.bat" --simulations-folder .\src\test\scala\webservice\gatling\simulation\</code></span></p>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note</strong>: You can also investigate if the&nbsp;<a href="https://github.com/lkishalmi/gradle-gatling-plugin" target="_blank" rel="noopener">gradle-gatling-plugin</a>&nbsp;can be used and if it offers a more convenient way to start Gatling from Gradle, instead of using the <code>JavaExec</code>&nbsp;task.</span></p>
<h2><a id="TestLoad"></a>Setup Gradle to automate the Gatling load tests</h2>
<p>At this point, you managed to start the Gatling tests from Gradle. However, you have to manually make sure that the Spring Boot web service is up and running, before you can start the Gatling tests. This is a problem if you want to automate the process. In the next steps you will solve this problem, by extending the Gradle scripts to:</p>
<p style="padding-left: 30px;">• launch the Spring Boot web service<br>
• wait until it is up and running<br>
• then execute the Gatling load test and<br>
• finally shut down the Spring Boot web service, when the tests are over.</p>
<p>The advantage of this approach is that, since the complete process is executed from a grade script, it can be easily become part of a CI/CD automated build pipeline, without the need for manual intervention.</p>
<h3>Add Actuator to the Spring Boot web service</h3>
<p>For checking the status of the Spring Boot web service, you will add the <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready">Spring Boot Actuator</a> to your web service. You can read the <a href="https://spring.io/guides/gs/actuator-service/">Building a RESTful Web Service with Spring Boot Actuator</a> tutorial if you want to better understand the process.</p>
<p>Edit the <code>build.gradle</code> file and add in the dependencies section the following line:</p>
<div><div id="highlighter_718480" class="syntaxhighlighter nogutter  groovy"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="groovy plain">compile(</code><code class="groovy string">'org.springframework.boot:spring-boot-starter-actuator'</code><code class="groovy plain">)</code></div></div></td></tr></tbody></table></div></div>
<p>By adding Actuator to your web service, you get several new <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html">endpoints</a>. The endpoint that is interesting to your purposes, is the <code>http://localhost:8080/health</code> endpoint. You will use this endpoint to check when the Spring Boot web service is up and running.</p>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note</strong>:You can manually try out the new endpoint. Run <code>gradlew bootRun</code> in a command prompt. Gradle will download all required dependencies and eventually start the Spring Boot web service. Open the <code>http://localhost:8080/health</code> endpoint in a browser and you should see the following JSON: <code>{"status": "UP"}</code></span></p>
<h3>Define the Spring Boot start, stop and wait Gradle tasks</h3>
<p>Now that you have a way to check if the Spring Boot web service is up, you will extend the <code>build.gradle</code> script to define the following tasks:</p>
<p style="padding-left: 30px;">• <code>startSpringBoot</code>: Start the Spring Boot web service in the background (in a separate process).<br>
• <code>stopSpringBoot</code>: Stop the Spring Boot web service that was started by <code>startSpringBoot</code>.<br>
• <code>waitUntilSringBootIsUp</code>: Call the <code>/health</code> endpoint and wait until it responds</p>
<p>Edit the <code>build.gradle</code> script and replace it with the following code:</p>
<div><div id="highlighter_622006" class="syntaxhighlighter  groovy"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2 highlighted">1</div><div class="line number2 index1 alt1 highlighted">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2 highlighted">7</div><div class="line number8 index7 alt1 highlighted">8</div><div class="line number9 index8 alt2 highlighted">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2 highlighted">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1 highlighted">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1 highlighted">44</div><div class="line number45 index44 alt2 highlighted">45</div><div class="line number46 index45 alt1 highlighted">46</div><div class="line number47 index46 alt2 highlighted">47</div><div class="line number48 index47 alt1 highlighted">48</div><div class="line number49 index48 alt2 highlighted">49</div><div class="line number50 index49 alt1 highlighted">50</div><div class="line number51 index50 alt2 highlighted">51</div><div class="line number52 index51 alt1 highlighted">52</div><div class="line number53 index52 alt2 highlighted">53</div><div class="line number54 index53 alt1 highlighted">54</div><div class="line number55 index54 alt2 highlighted">55</div><div class="line number56 index55 alt1 highlighted">56</div><div class="line number57 index56 alt2 highlighted">57</div><div class="line number58 index57 alt1 highlighted">58</div><div class="line number59 index58 alt2 highlighted">59</div><div class="line number60 index59 alt1 highlighted">60</div><div class="line number61 index60 alt2 highlighted">61</div><div class="line number62 index61 alt1 highlighted">62</div><div class="line number63 index62 alt2 highlighted">63</div><div class="line number64 index63 alt1 highlighted">64</div><div class="line number65 index64 alt2 highlighted">65</div><div class="line number66 index65 alt1 highlighted">66</div><div class="line number67 index66 alt2 highlighted">67</div><div class="line number68 index67 alt1 highlighted">68</div><div class="line number69 index68 alt2 highlighted">69</div><div class="line number70 index69 alt1 highlighted">70</div><div class="line number71 index70 alt2 highlighted">71</div><div class="line number72 index71 alt1 highlighted">72</div><div class="line number73 index72 alt2 highlighted">73</div><div class="line number74 index73 alt1 highlighted">74</div><div class="line number75 index74 alt2 highlighted">75</div><div class="line number76 index75 alt1 highlighted">76</div><div class="line number77 index76 alt2 highlighted">77</div><div class="line number78 index77 alt1 highlighted">78</div><div class="line number79 index78 alt2 highlighted">79</div><div class="line number80 index79 alt1 highlighted">80</div><div class="line number81 index80 alt2 highlighted">81</div><div class="line number82 index81 alt1 highlighted">82</div><div class="line number83 index82 alt2 highlighted">83</div><div class="line number84 index83 alt1 highlighted">84</div><div class="line number85 index84 alt2 highlighted">85</div><div class="line number86 index85 alt1 highlighted">86</div><div class="line number87 index86 alt2 highlighted">87</div><div class="line number88 index87 alt1 highlighted">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1">102</div><div class="line number103 index102 alt2">103</div><div class="line number104 index103 alt1">104</div><div class="line number105 index104 alt2">105</div><div class="line number106 index105 alt1">106</div><div class="line number107 index106 alt2">107</div><div class="line number108 index107 alt1">108</div><div class="line number109 index108 alt2">109</div><div class="line number110 index109 alt1">110</div><div class="line number111 index110 alt2 highlighted">111</div><div class="line number112 index111 alt1 highlighted">112</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2 highlighted"><code class="groovy keyword">import</code> <code class="groovy plain">com.github.jengelman.gradle.plugins.processes.tasks.JavaFork</code></div><div class="line number2 index1 alt1 highlighted"><code class="groovy keyword">import</code> <code class="groovy plain">groovy.json.JsonSlurper</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="groovy plain">buildscript {</code></div><div class="line number5 index4 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">repositories {</code></div><div class="line number6 index5 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">mavenCentral()</code></div><div class="line number7 index6 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">maven {</code></div><div class="line number8 index7 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">url </code><code class="groovy string">'<a href="https://plugins.gradle.org/m2/">https://plugins.gradle.org/m2/</a>'</code></div><div class="line number9 index8 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number10 index9 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number11 index10 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">dependencies {</code></div><div class="line number12 index11 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">classpath </code><code class="groovy string">'org.springframework.boot:spring-boot-gradle-plugin:1.5.6.RELEASE'</code></div><div class="line number13 index12 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">classpath </code><code class="groovy string">'com.github.jengelman.gradle.plugins:gradle-processes:0.3.0'</code></div><div class="line number14 index13 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number15 index14 alt2"><code class="groovy plain">}</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="groovy plain">apply plugin: </code><code class="groovy string">'java'</code></div><div class="line number18 index17 alt1"><code class="groovy plain">apply plugin: </code><code class="groovy string">'org.springframework.boot'</code></div><div class="line number19 index18 alt2"><code class="groovy plain">apply plugin: </code><code class="groovy string">'scala'</code></div><div class="line number20 index19 alt1 highlighted"><code class="groovy plain">apply plugin: </code><code class="groovy string">'com.github.johnrengelman.processes'</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="groovy plain">jar {</code></div><div class="line number23 index22 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">baseName = </code><code class="groovy string">'webservice'</code></div><div class="line number24 index23 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">version =&nbsp; </code><code class="groovy string">'0.1.0'</code></div><div class="line number25 index24 alt2"><code class="groovy plain">}</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="groovy plain">repositories {</code></div><div class="line number28 index27 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">mavenCentral()</code></div><div class="line number29 index28 alt2"><code class="groovy plain">}</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="groovy plain">sourceCompatibility = </code><code class="groovy value">1.8</code></div><div class="line number32 index31 alt1"><code class="groovy plain">targetCompatibility = </code><code class="groovy value">1.8</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="groovy plain">dependencies {</code></div><div class="line number35 index34 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">compile(</code><code class="groovy string">'org.springframework.boot:spring-boot-starter-web'</code><code class="groovy plain">)</code></div><div class="line number36 index35 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">compile(</code><code class="groovy string">'org.springframework.boot:spring-boot-starter-actuator'</code><code class="groovy plain">)</code></div><div class="line number37 index36 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">testCompile(</code><code class="groovy string">'io.gatling.highcharts:gatling-charts-highcharts:2.3.0'</code><code class="groovy plain">)</code></div><div class="line number38 index37 alt1"><code class="groovy plain">}</code></div><div class="line number39 index38 alt2">&nbsp;</div><div class="line number40 index39 alt1"><code class="groovy comments">/**</code></div><div class="line number41 index40 alt2"><code class="groovy spaces">&nbsp;</code><code class="groovy comments">* Gatling load tests</code></div><div class="line number42 index41 alt1"><code class="groovy spaces">&nbsp;</code><code class="groovy comments">*/</code></div><div class="line number43 index42 alt2">&nbsp;</div><div class="line number44 index43 alt1 highlighted"><code class="groovy plain">task startSpringBoot(type: JavaFork) {</code></div><div class="line number45 index44 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">description = </code><code class="groovy string">'Start Spring Boot in the background.'</code></div><div class="line number46 index45 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">group = </code><code class="groovy string">'Load Test'</code></div><div class="line number47 index46 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">classpath = sourceSets.main.runtimeClasspath</code></div><div class="line number48 index47 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">main = </code><code class="groovy string">'webservice.Application'</code>&nbsp;&nbsp;&nbsp;</div><div class="line number49 index48 alt2 highlighted"><code class="groovy plain">}</code></div><div class="line number50 index49 alt1 highlighted"><code class="groovy plain">startSpringBoot.dependsOn assemble</code></div><div class="line number51 index50 alt2 highlighted">&nbsp;</div><div class="line number52 index51 alt1 highlighted"><code class="groovy plain">task stopSpringBoot &lt;&lt; {</code></div><div class="line number53 index52 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">description = </code><code class="groovy string">'Stop the instance of Spring Boot that was started with \'startSpringBoot\''</code></div><div class="line number54 index53 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">group = </code><code class="groovy string">'Load Test'</code></div><div class="line number55 index54 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">startSpringBoot.processHandle.abort()</code></div><div class="line number56 index55 alt1 highlighted"><code class="groovy plain">}</code></div><div class="line number57 index56 alt2 highlighted">&nbsp;</div><div class="line number58 index57 alt1 highlighted"><code class="groovy plain">task waitUntilSpringBootIsUp &lt;&lt; {</code></div><div class="line number59 index58 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">description = </code><code class="groovy string">'Call the /health endpoint and wait until it responds with the status UP.'</code></div><div class="line number60 index59 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">group = </code><code class="groovy string">'Load Test'</code></div><div class="line number61 index60 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">String url = </code><code class="groovy string">'<a href="http://localhost:8080/health">http://localhost:8080/health</a>'</code></div><div class="line number62 index61 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy color1">boolean</code> <code class="groovy plain">success = false</code></div><div class="line number63 index62 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy color1">int</code> <code class="groovy functions">count</code> <code class="groovy plain">= </code><code class="groovy value">0</code></div><div class="line number64 index63 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy keyword">while</code> <code class="groovy plain">(</code><code class="groovy functions">count</code> <code class="groovy plain">&lt; </code><code class="groovy value">15</code> <code class="groovy plain">&amp;&amp; !success) {</code></div><div class="line number65 index64 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">println</code> <code class="groovy string">'Trying to connect to \''</code> <code class="groovy plain">+ url + </code><code class="groovy string">'\' : Attempt number='</code> <code class="groovy plain">+ </code><code class="groovy functions">count</code></div><div class="line number66 index65 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy keyword">try</code> <code class="groovy plain">{</code></div><div class="line number67 index66 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">count</code> <code class="groovy plain">+= </code><code class="groovy value">1</code></div><div class="line number68 index67 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">JsonSlurper jsonSlurper = </code><code class="groovy keyword">new</code> <code class="groovy plain">JsonSlurper();</code></div><div class="line number69 index68 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">String responceBody = url.toURL().text</code></div><div class="line number70 index69 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">println</code> <code class="groovy plain">responceBody</code></div><div class="line number71 index70 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">Object result = jsonSlurper.parseText(responceBody);</code></div><div class="line number72 index71 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">Map jsonResult = (Map) result;</code></div><div class="line number73 index72 alt2 highlighted">&nbsp;</div><div class="line number74 index73 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">String status = (String) jsonResult.</code><code class="groovy functions">get</code><code class="groovy plain">(</code><code class="groovy string">'status'</code><code class="groovy plain">);</code></div><div class="line number75 index74 alt2 highlighted">&nbsp;</div><div class="line number76 index75 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">success = (status == </code><code class="groovy string">'UP'</code><code class="groovy plain">)</code></div><div class="line number77 index76 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number78 index77 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy keyword">catch</code> <code class="groovy plain">(all) {</code></div><div class="line number79 index78 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">sleep(</code><code class="groovy value">5</code> <code class="groovy plain">* </code><code class="groovy value">1000</code><code class="groovy plain">) </code><code class="groovy comments">// wait for another 5 seconds until next retry</code></div><div class="line number80 index79 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number81 index80 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number82 index81 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy keyword">if</code> <code class="groovy plain">(success) {</code></div><div class="line number83 index82 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">println</code> <code class="groovy string">'SUCCEFULLY Connected to \''</code> <code class="groovy plain">+ url + </code><code class="groovy string">'\''</code></div><div class="line number84 index83 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">} </code><code class="groovy keyword">else</code> <code class="groovy plain">{</code></div><div class="line number85 index84 alt2 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">println</code> <code class="groovy string">'FAILED to Connected to \''</code> <code class="groovy plain">+ url + </code><code class="groovy string">'\''</code></div><div class="line number86 index85 alt1 highlighted"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number87 index86 alt2 highlighted"><code class="groovy plain">}</code></div><div class="line number88 index87 alt1 highlighted"><code class="groovy plain">waitUntilSpringBootIsUp.dependsOn startSpringBoot</code></div><div class="line number89 index88 alt2">&nbsp;</div><div class="line number90 index89 alt1"><code class="groovy plain">task testLoad(type: JavaExec) {</code></div><div class="line number91 index90 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">description = </code><code class="groovy string">'Test load the Spring Boot web service with Gatling'</code></div><div class="line number92 index91 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">group = </code><code class="groovy string">'Load Test'</code></div><div class="line number93 index92 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">classpath = sourceSets.test.runtimeClasspath</code></div><div class="line number94 index93 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">jvmArgs = [</code></div><div class="line number95 index94 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy comments">// workaround for <a href="https://github.com/gatling/gatling/issues/2689">https://github.com/gatling/gatling/issues/2689</a></code></div><div class="line number96 index95 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">"-Dgatling.core.directory.binaries=${sourceSets.test.output.classesDir.toString()}"</code><code class="groovy plain">,</code></div><div class="line number97 index96 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">"-Dlogback.configurationFile=${logbackGatlingConfig()}"</code></div><div class="line number98 index97 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">]</code></div><div class="line number99 index98 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">main = </code><code class="groovy string">'io.gatling.app.Gatling'</code></div><div class="line number100 index99 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">args = [</code></div><div class="line number101 index100 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">'--simulation'</code><code class="groovy plain">, </code><code class="groovy string">'webservice.gatling.simulation.WebServiceCallSimulation'</code><code class="groovy plain">,</code></div><div class="line number102 index101 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">'--results-folder'</code><code class="groovy plain">, </code><code class="groovy string">"${buildDir}/gatling-results"</code><code class="groovy plain">,</code></div><div class="line number103 index102 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy string">'--binaries-folder'</code><code class="groovy plain">, sourceSets.test.output.classesDir.toString() </code><code class="groovy comments">// ignored because of above bug&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div><div class="line number104 index103 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">]</code></div><div class="line number105 index104 alt2"><code class="groovy plain">}</code></div><div class="line number106 index105 alt1">&nbsp;</div><div class="line number107 index106 alt2"><code class="groovy keyword">def</code> <code class="groovy plain">logbackGatlingConfig() {</code></div><div class="line number108 index107 alt1"><code class="groovy spaces">&nbsp;</code><code class="groovy keyword">return</code> <code class="groovy plain">sourceSets.test.resources.</code><code class="groovy functions">find</code> <code class="groovy plain">{ it.name == </code><code class="groovy string">'logback-gatling.xml'</code><code class="groovy plain">};</code></div><div class="line number109 index108 alt2"><code class="groovy plain">}</code></div><div class="line number110 index109 alt1">&nbsp;</div><div class="line number111 index110 alt2 highlighted"><code class="groovy plain">testLoad.dependsOn waitUntilSpringBootIsUp</code></div><div class="line number112 index111 alt1 highlighted"><code class="groovy plain">testLoad.finalizedBy stopSpringBoot</code></div></div></td></tr></tbody></table></div></div>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note</strong>: The changed/added code has been highlighted in the listing above,.</span></p>
<p>Lets now examine in detail the code changes you introduced and how they work.</p>
<h3>Launch/Stop the Spring Boot web service</h3>
<div><div id="highlighter_273444" class="syntaxhighlighter nogutter  groovy"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="groovy keyword">import</code> <code class="groovy plain">com.github.jengelman.gradle.plugins.processes.tasks.JavaFork</code></div><div class="line number2 index1 alt1"><code class="groovy plain">...</code></div><div class="line number3 index2 alt2"><code class="groovy plain">buildscript {</code></div><div class="line number4 index3 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">repositories {</code></div><div class="line number5 index4 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">...</code></div><div class="line number6 index5 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">maven {</code></div><div class="line number7 index6 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">url </code><code class="groovy string">'<a href="https://plugins.gradle.org/m2/">https://plugins.gradle.org/m2/</a>'</code></div><div class="line number8 index7 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number9 index8 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number10 index9 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">dependencies {</code></div><div class="line number11 index10 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">...</code></div><div class="line number12 index11 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">classpath </code><code class="groovy string">'com.github.jengelman.gradle.plugins:gradle-processes:0.3.0'</code></div><div class="line number13 index12 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number14 index13 alt1"><code class="groovy plain">}</code></div><div class="line number15 index14 alt2"><code class="groovy plain">...</code></div><div class="line number16 index15 alt1"><code class="groovy plain">apply plugin: </code><code class="groovy string">'com.github.johnrengelman.processes'</code></div><div class="line number17 index16 alt2"><code class="groovy plain">...</code></div><div class="line number18 index17 alt1"><code class="groovy plain">task startSpringBoot(type: JavaFork) {</code></div><div class="line number19 index18 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">description = </code><code class="groovy string">'Start Spring Boot in the background.'</code></div><div class="line number20 index19 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">group = </code><code class="groovy string">'Load Test'</code></div><div class="line number21 index20 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">classpath = sourceSets.main.runtimeClasspath</code></div><div class="line number22 index21 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">main = </code><code class="groovy string">'webservice.Application'</code>&nbsp;&nbsp;&nbsp;</div><div class="line number23 index22 alt2"><code class="groovy plain">}</code></div><div class="line number24 index23 alt1"><code class="groovy plain">startSpringBoot.dependsOn assemble</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="groovy plain">task stopSpringBoot &lt;&lt; {</code></div><div class="line number27 index26 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">description = </code><code class="groovy string">'Stop the instance of Spring Boot that was started with \'startSpringBoot\''</code></div><div class="line number28 index27 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">group = </code><code class="groovy string">'Load Test'</code></div><div class="line number29 index28 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">startSpringBoot.processHandle.abort()</code></div><div class="line number30 index29 alt1"><code class="groovy plain">}</code></div><div class="line number31 index30 alt2"><code class="groovy plain">...</code></div></div></td></tr></tbody></table></div></div>
<p>First, you added the <a href="https://github.com/johnrengelman/gradle-processes">Gradle-Processes plugin</a>, which provides the capability to create forked processes. Then, you defined the <code>startSpringBoot</code>, which uses the new <code>type: JavaFork</code> to start the Spring Boot web service in a forked process. Since the jar file needs to be assembled before it can be executed, you also declared a dependency to the <code>assemble</code> task. Then, you defined the <code>stopSpringBoot</code> task, which can be used to stop the process of the <code>startSpringBoot</code> task.</p>
<p style="padding-left: 30px;"><span style="font-size: 10pt;"><strong>Note:</strong>You can investigate how to rewrite the <code>stopSpringBoot</code> task, to use the actuator <code>/shutdown</code> endpoint, instead of the <code>processHandle.abort()</code> function. Be aware that the <code>/shutdown</code> endpoint is disabled by default and you have to <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html#production-ready-customizing-endpoints">explicitly enable it</a>.</span></p>
<h3>Wait until the Spring Boot web service is up and running</h3>
<div><div id="highlighter_113823" class="syntaxhighlighter nogutter  groovy"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="groovy plain">...</code></div><div class="line number2 index1 alt1"><code class="groovy keyword">import</code> <code class="groovy plain">groovy.json.JsonSlurper</code></div><div class="line number3 index2 alt2"><code class="groovy plain">...</code></div><div class="line number4 index3 alt1"><code class="groovy plain">task waitUntilSpringBootIsUp &lt;&lt; {</code></div><div class="line number5 index4 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">description = </code><code class="groovy string">'Call the /health endpoint and wait until it responds with the status UP.'</code></div><div class="line number6 index5 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">group = </code><code class="groovy string">'Load Test'</code></div><div class="line number7 index6 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">String url = </code><code class="groovy string">'<a href="http://localhost:8080/health">http://localhost:8080/health</a>'</code></div><div class="line number8 index7 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy color1">boolean</code> <code class="groovy plain">success = false</code></div><div class="line number9 index8 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy color1">int</code> <code class="groovy functions">count</code> <code class="groovy plain">= </code><code class="groovy value">0</code></div><div class="line number10 index9 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy keyword">while</code> <code class="groovy plain">(</code><code class="groovy functions">count</code> <code class="groovy plain">&lt; </code><code class="groovy value">15</code> <code class="groovy plain">&amp;&amp; !success) {</code></div><div class="line number11 index10 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">println</code> <code class="groovy string">'Trying to connect to \''</code> <code class="groovy plain">+ url + </code><code class="groovy string">'\' : Attempt number='</code> <code class="groovy plain">+ </code><code class="groovy functions">count</code></div><div class="line number12 index11 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy keyword">try</code> <code class="groovy plain">{</code></div><div class="line number13 index12 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">count</code> <code class="groovy plain">+= </code><code class="groovy value">1</code></div><div class="line number14 index13 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">JsonSlurper jsonSlurper = </code><code class="groovy keyword">new</code> <code class="groovy plain">JsonSlurper();</code></div><div class="line number15 index14 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">String responceBody = url.toURL().text</code></div><div class="line number16 index15 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">println</code> <code class="groovy plain">responceBody</code></div><div class="line number17 index16 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">Object result = jsonSlurper.parseText(responceBody);</code></div><div class="line number18 index17 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">Map jsonResult = (Map) result;</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">String status = (String) jsonResult.</code><code class="groovy functions">get</code><code class="groovy plain">(</code><code class="groovy string">'status'</code><code class="groovy plain">);</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">success = (status == </code><code class="groovy string">'UP'</code><code class="groovy plain">)</code></div><div class="line number23 index22 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number24 index23 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy keyword">catch</code> <code class="groovy plain">(all) {</code></div><div class="line number25 index24 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">sleep(</code><code class="groovy value">5</code> <code class="groovy plain">* </code><code class="groovy value">1000</code><code class="groovy plain">) </code><code class="groovy comments">// wait for another 5 seconds until next retry</code></div><div class="line number26 index25 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number27 index26 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number28 index27 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy keyword">if</code> <code class="groovy plain">(success) {</code></div><div class="line number29 index28 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">println</code> <code class="groovy string">'SUCCEFULLY Connected to \''</code> <code class="groovy plain">+ url + </code><code class="groovy string">'\''</code></div><div class="line number30 index29 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">} </code><code class="groovy keyword">else</code> <code class="groovy plain">{</code></div><div class="line number31 index30 alt2"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy functions">println</code> <code class="groovy string">'FAILED to Connected to \''</code> <code class="groovy plain">+ url + </code><code class="groovy string">'\''</code></div><div class="line number32 index31 alt1"><code class="groovy spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="groovy plain">}</code></div><div class="line number33 index32 alt2"><code class="groovy plain">}</code></div><div class="line number34 index33 alt1"><code class="groovy plain">waitUntilSpringBootIsUp.dependsOn startSpringBoot</code></div><div class="line number35 index34 alt2"><code class="groovy plain">....</code></div></div></td></tr></tbody></table></div></div>
<p>You imported <code>groovy.json.JsonSlurper</code>, which offers functionality to parse the JSON response from the Actuator health endpoint. You defined the <code>waitUntilSpringBootIsUp</code> task, which attempts to call the <code>/health</code> endpoint. If the task fails to receive a status <code>UP</code> in the JSON response, it will retry several times and finally give up. You also declared that the <code>waitUntilSpringBootIsUp</code> has a dependency to the <code>startSpringBoot</code> task.</p>
<h3>Start the Gatling test if the web service is up and running</h3>
<div><div id="highlighter_723952" class="syntaxhighlighter nogutter  groovy"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="groovy plain">...</code></div><div class="line number2 index1 alt1"><code class="groovy plain">testLoad.dependsOn waitUntilSpringBootIsUp</code></div><div class="line number3 index2 alt2"><code class="groovy plain">testLoad.finalizedBy stopSpringBoot</code></div></div></td></tr></tbody></table></div></div>
<p>Finally, you declared that the <code>testLoad</code> task has a dependency to the <code>waitUntilSpringBootIsUp</code> task and that when it completes, the <code>stopSpringBoot</code> should be called.</p>
<h3>Putting everything together</h3>
<p>Because of the dependencies you defined between the tasks, when the <code>testLoad</code> task is executed (by calling <code>gradlew testLoad</code>), before it starts, it will call <code>waitUntilSpringBootIsUp</code> which will in turn call the <code>startSpringBoot</code> task. This task will effectively launch the Spring Boot web service in the background (if required the jars will be assembled first). While <code>startSpringBoot</code> runs, <code>waitUntilSpringBootIsUp</code> concurrently attempts to establish if the service is up. Once the service is up, <code>waitUntilSpringBootIsUp</code> will complete, allowing for the <code>testLoad</code> to start. Once <code>testLoad</code> is completed, the <code>stopSpringBoot</code> will be called, ending the Spring Boot web service.</p>
<p>You can now try it out by simply running <code>gradlew testLoad</code> in the command prompt.</p>
<h2>Epilogue</h2>
<p>Congratulations! You have successfully reached the end of this tutorial. </p>
<p>You learned how to write a simple Spring Boot web service and load test it using Gatling. You also learned how to setup Gradle to perform all the actions required to run the load test in an automated fashion. </p>
<p>You can get the complete source code from the git repository:<br>
<code>git clone https://bitbucket.org/apostolosbenisis/tutorial-gatling.git</code></p>


<div class="authorship">
	<small>September 11th, 2017		by <a href="http://brokenrhythm.blog/author/apostolosbenisis" title="Posts by Apostolos Benisis" rel="author">Apostolos Benisis</a> 
	<div class="edit-post alignright">
			</div><!-- /edit-post -->
	</small>
</div><!-- /authorship -->


    	
    <div class="social-magazine-comments">
                
                        
                        
    	
</div><!-- /social-magazine-comments --></div><!-- /blog-block -->
	<nav class="navigation post-navigation" role="navigation">
		<h2 class="screen-reader-text">Other Articles</h2>
		<div class="nav-links"><div class="nav-previous"><a href="http://brokenrhythm.blog/mistakes-in-a-safe-environment" rel="prev"><span class="post-title">Dealing with mistakes in a safe environment</span></a></div><div class="nav-next"><a href="http://brokenrhythm.blog/howto-test-thread-safety-java-testng" rel="next"><span class="post-title">How to test thread safety in Java with TestNG</span></a></div></div>
	</nav>						
			</div></DIV></DIV>
  </body>
</html>